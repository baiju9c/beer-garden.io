<!DOCTYPE html><!--[if IE 8]><html class="no-js lt-ie9" lang="en"><![endif]--><!--[if gt IE 8 ]><!--><html class="no-js" lang="en"><!--<![endif]--><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="stylesheet" href="/stylesheets/styles.css"><script src="/javascripts/jquery.js"></script><script src="/javascripts/bootstrap.min.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-113442079-2"></script><title>Beer Garden Documentation</title></head><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-113442079-2');</script><body class="antialiased"><div class="bootstrap"><nav class="navbar navbar-default navbar-fixed-top" role="navigation"><div class="container"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle Navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="/"><img src="/images/bg-banner.png">Beer Garden</img></a></div><div class="collapse navbar-collapse" id="navbar-collapse-1"><ul class="nav navbar-nav navbar-right"><li><a href="/">Home</a></li><li class="divider"></li><li><a href="https://github.com/beer-garden/beer-garden">Code</a></li><li class="divider"></li><li><a href="https://gitter.im/beer-garden-io/Lobby">Discuss</a></li><li class="divider"></li><li><a href="/docs/">Docs</a></li></ul></div></div></nav><main><div class="bootstrap masthead"><div class="container"><h2 class="hero">Beer Garden Architecture</h2></div></div><div class="bootstrap container"><div class="row top-buffer"><div class="col-lg-4"><div class="col-lg-12"><div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups"><div class="btn-group mr-2" role="group" aria-label="First group"><button class="btn btn-default toggle-navigation" type="button" href="#"><span class="toggle-target"><i class="fa fa-toggle-on"></i><i class="fa fa-toggle-off"></i> Nav</span></button></div><div class="btn-group-mr-2 pull-right" role="group" aria-label="First Group"><a class="btn btn-default" href="https://github.com/beer-garden/beer-garden.io/edit/master//docs/architecture.adoc">Edit</a><a class="btn btn-default" href="https://github.com/beer-garden/beer-garden.io/raw/master//docs/architecture.adoc">Raw</a><a class="btn btn-default" href="https://github.com/beer-garden/beer-garden.io/commits/master//docs/architecture.adoc">History</a></div></div></div><div class="col-lg-12 navigation"><div id="toc" class="toc"><div class="title" id="toctitle">Table of Contents</div><ul class="sectlevel2">
<li><a href="#event-notifications">Event Notifications</a>
<ul class="sectlevel3">
<li><a href="#event-structure">Event Structure</a></li>
<li><a href="#enabling-events">Enabling Events</a></li>
<li><a href="#publishing-custom-events">Publishing Custom Events</a></li>
</ul>
</li>
</ul></div></div></div><div class="col-lg-8" id="docContent"><div class="sect2">
<h3 id="event-notifications"><a class="anchor" href="#event-notifications"></a>Event Notifications</h3>
<div class="paragraph">
<p>Sometimes, particularly if you&#8217;re integrating with Beer Garden, it can be helpful to know when certain things happen. To make this process as easy as possible Beer Garden supports the concept of <em>event notifications</em>.</p>
</div>
<div class="paragraph">
<p>Events are generated whenever any of the following events occur:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Bartender started</p>
</li>
<li>
<p>Bartender stopped</p>
</li>
<li>
<p>Brew view started</p>
</li>
<li>
<p>Brew view stopped</p>
</li>
<li>
<p>Request created</p>
</li>
<li>
<p>Request started</p>
</li>
<li>
<p>Request completed</p>
</li>
<li>
<p>Instance initialized</p>
</li>
<li>
<p>Instance started</p>
</li>
<li>
<p>Instance stopped</p>
</li>
<li>
<p>System created</p>
</li>
<li>
<p>System updated</p>
</li>
<li>
<p>System removed</p>
</li>
<li>
<p>Queue cleared</p>
</li>
<li>
<p>All queues cleared</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="event-structure"><a class="anchor" href="#event-structure"></a>Event Structure</h4>
<div class="paragraph">
<p>Events will always be well-formed JSON. Here&#8217;s an example of an event:</p>
</div>
<div class="listingblock">
<div class="title">event.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">REQUEST_CREATED</span><span class="delimiter">&quot;</span></span>, <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">timestamp</span><span class="delimiter">&quot;</span></span>: <span class="integer">1521126132897</span>, <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">error</span><span class="delimiter">&quot;</span></span>: <span class="error">N</span><span class="error">o</span><span class="error">n</span><span class="error">e</span>, <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="key"><span class="delimiter">&quot;</span><span class="content">metadata</span><span class="delimiter">&quot;</span></span>: { <i class="conum" data-value="4"></i><b>(4)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">entity_url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://this.is.beergarden:443/api/v1/requests/5aaa8af45991735bf1a6c123</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">public_url</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://this.is.beergarden:443/</span><span class="delimiter">&quot;</span></span>
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">payload</span><span class="delimiter">&quot;</span></span>: { <i class="conum" data-value="5"></i><b>(5)</b>
        <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">5aaa8af45991735bf1a6c123</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">command</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">say</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">system</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">echo</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">system_version</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">instance_name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>All events will have a name</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>All events will have a timestamp (milliseconds since the epoch)</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>All events will have an error flag (boolean, None being equivalent to False)</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Events may have a metadata field. This will contain 'extra' useful information, but will normally include at least the the public url of the Beer Garden that generated the Event. Events that relate to a specific entity will also include a url that can be used to retrieve the full entity definition.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Events may have a payload. The specific data included will vary based on event type.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="enabling-events"><a class="anchor" href="#enabling-events"></a>Enabling Events</h4>
<div class="paragraph">
<p>Events are disabled by default, but they can be published to a RabbitMQ topic exchange and/or persisted to MongoDB.</p>
</div>
<div class="sect4">
<h5 id="mongo"><a class="anchor" href="#mongo"></a>Mongo</h5>
<div class="paragraph">
<p>To perist events to Mongo set the <code>event_persist_mongo</code> configuration option in Brew view to <code>True</code>:</p>
</div>
<div class="listingblock">
<div class="title">config.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">event_persist_mongo</span><span class="delimiter">&quot;</span></span>: <span class="error">T</span><span class="error">r</span><span class="error">u</span><span class="error">e</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="rabbitmq"><a class="anchor" href="#rabbitmq"></a>RabbitMQ</h5>
<div class="paragraph">
<p>To publish events to RabbitMQ set the <code>event_amq_virtual_host</code> and <code>event_amq_exchange</code> configuration options to valid values.</p>
</div>
<div class="listingblock">
<div class="title">config.json</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">event_amq_virtual_host</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">event_amq_exchange</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">beergarden_event</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Beer Garden doesn&#8217;t create an exchange for events. While you <em>could</em> use the normal Beer Garden request exchange we recommend you don&#8217;t. Instead, you should create a separate exchange. Check the RabbitMQ docs for instructions on how to do this.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To consume from RabbitMQ, you&#8217;ll need to create a queue on the same virtual host as <code>event_amq_virtual_host</code> and then bind that queue to a routing key on the <code>event_amq_exchange</code>. To receive all events you can bind to the <code>#</code> routing key. If you want to filter which events your queue will receive there are some rules about how Beer Garden assigns routing keys to events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The default routing key is 'beergarden'. Events that don&#8217;t fit any other rules will use this.</p>
</li>
<li>
<p>Request events will have a routing key of the form <code>request.&lt;system_name&gt;.&lt;mangled_system_version&gt;.&lt;instance_name&gt;</code>. Since RabbitMQ treats '.' as a delimiter the system version is mangled to replace all instances of '.' with '-'. So an example would be <code>request.echo.1-0-0.default</code>. If you were only interested in requests related to the 'echo' system you could bind your queue to the <code>request.echo.#</code> routing key.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="publishing-custom-events"><a class="anchor" href="#publishing-custom-events"></a>Publishing Custom Events</h4>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
This is a beta capability
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It&#8217;s possible to publish your own events. Just POST a valid Event to the <code>/api/vbeta/events</code> endpoint. The brewtils EasyClient <code>publish_event</code> method can help with this.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="title">Discuss and Contribute</div>
Use <a href="https://github.com/beer-garden/beer-garden.io/issues/4">Issue 4</a> to drive development of this section. Your contributions make a difference.  No contribution is too small.
</td>
</tr>
</table>
</div>
</div>
</div></div><hr></div></div></main></div><footer id="bgfooter"><div class="container"><div class="row"><div class="col-sm-3"><h5>Get Started</h5><ul><li><a href="/">Home</a></li><li><a href="https://github.com/beer-garden/beer-garden/blob/master/CONTRIBUTING.md">Contribute</a></li></ul></div><div class="col-sm-3"><h5>About us</h5><ul><li><a href="https://github.com/beer-garden/beer-garden/blob/master/AUTHORS.md">Contributors</a></li><li><a href="/news">News</a></li></ul></div><div class="col-sm-3"><h5>Support</h5><ul><li><a href="https://gitter.im/beer-garden-io/Lobby">Gitter</a></li></ul></div><div class="col-sm-3 info"><h5>Information</h5><p>Composed in AsciiDoc. Styled by bootstrap. Baked with Awestruct.</p></div></div></div><div class="social-networks"><a class="github" href="https://github.com/beer-garden/beer-garden"><i class="fa fa-github"></i></a><a class="gitter" href="https://gitter.im/beer-garden-io/Lobby"><i class="fa fa-gitter"></i></a></div><div class="footer-copyright"><p>© Beer Garden Project 2018.</p></div></footer></body><script>$('.toggle-navigation').click(function() { $('.navigation').toggle(); $('#docContent').toggleClass('col-lg-8'); $('#docContent').toggleClass('col-lg-12'); $('#docContent').toggleClass('top-buffer'); $('.toggle-target').toggleClass('off'); });</script>